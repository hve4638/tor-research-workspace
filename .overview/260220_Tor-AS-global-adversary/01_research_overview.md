# 01. 연구 개요

## 연구 동기

Tor는 전 세계에서 가장 널리 사용되는 익명 통신 네트워크이다. 사용자의 트래픽을 3개의 릴레이(Guard → Middle → Exit)를 거쳐 전달함으로써, 어떤 단일 관찰자도 통신의 출발지와 목적지를 동시에 알 수 없도록 설계되어 있다.

그러나 Tor는 **네트워크 계층 아래의 위협**에는 취약하다. 인터넷의 라우팅은 AS(Autonomous System) 단위로 이루어지며, 특정 AS는 그 위치상 여러 Tor 회로의 진입 경로(client → Guard)와 출구 경로(Exit → destination)를 **동시에 관찰**할 수 있다. 이러한 AS-level 글로벌 관찰자는 트래픽의 타이밍과 볼륨을 상관(correlate)하여 사용자의 익명성을 파괴할 수 있다.

Johnson et al.(2013)은 현실적 AS-level 적대자가 vanilla Tor에서 **40%의 회로를 취약하게 만든다**고 보고했다. 이후 RAPTOR(2015)는 BGP 공격을 통한 능동적 경로 조작이, Tempest(2018)는 시간 경과에 따른 라우팅 변동이 위협을 더 증가시킨다는 것을 보였다.

본 연구는 이러한 AS-level 위협을 **종합적으로 시뮬레이션**하여, 글로벌 관찰자의 실제 상관 능력을 측정하고, 제안된 방어 전략(Counter-RAPTOR, Astoria)의 효과를 정량적으로 비교한다.

---

## 연구 질문

**RQ1: AS-level 글로벌 관찰자가 Tor 트래픽을 얼마나 상관(correlate)할 수 있는가?**
- Guard AS와 Exit AS를 동시에 관찰할 때의 상관 성공률
- 90일간 50 클라이언트, 1,944,150개 회로에 대한 정량 분석

**RQ2: 특정 AS 위치(IXP, Tier-1)가 추적 성공률에 얼마나 영향을 주는가?**
- 상위 transit AS의 관찰 지배력 분석
- BGP 공격 시 특정 AS 탈취의 영향 측정

**RQ3: Hidden Service 트래픽의 추적 가능성은 어떠한가?** *(M7, 보류)*
- 6-hop 회로(client + HS 양쪽)의 추가 관찰 표면 분석

---

## 프로젝트 전체 흐름

```
┌──────────────────┐     ┌──────────────────────┐     ┌──────────────────┐
│  데이터 수집       │     │  시뮬레이션            │     │  분석              │
│  (tor-anal)       │ ──→ │  (next-simulate)      │ ──→ │  (tor-anal)       │
│                   │     │                       │     │                   │
│  Onionoo API      │     │  이벤트 드리븐 엔진     │     │  NDJSON 파싱       │
│  CAIDA AS 관계    │     │  3-hop 회로 생성       │     │  상관율 계산        │
│  RouteViews RIB   │     │  BGP 공격 시뮬레이션   │     │  방어 비교          │
│  RIR 지리 정보    │     │  방어 전략 적용        │     │  시각화 (6종 PNG)   │
│                   │     │                       │     │                   │
│  → JSON 모델 산출  │     │  → NDJSON 로그 산출    │     │  → 정량 리포트      │
└──────────────────┘     └──────────────────────┘     └──────────────────┘
```

**입력**: 727개 AS 노드, 6,325개 AS 간 연결, 69개국 지리 매핑
**시뮬레이션**: 90일, 50 클라이언트, 3개 CAIDA 스냅샷, 3건 BGP 공격
**출력**: 4개 시나리오 × 2개 NDJSON = 8개 파일 → JSON 리포트 + 6종 시각화

---

## 마일스톤 진행표

| 마일스톤 | 상태 | 내용 요약 |
|----------|------|----------|
| M1 | 완료 | 아키텍처 설계, 타입 시스템, AS 그래프, 이벤트 엔진, valley-free BFS |
| M2 | 완료 | 디렉토리 서비스, Guard 선택 (Proposal 271), 가중치 행렬 기반 노드 선택 |
| M3 | 완료 | 3-hop 회로 생성, AS 경로 계산, NDJSON 관찰 로깅, entry/exit 판정 |
| M4 | 완료 | 동적 AS 토폴로지 (CAIDA 스냅샷 전환), Guard 수명 추적, 노드 churn |
| M5 | 완료 | BGP Hijack/Interception, 비대칭 경로, 4종 적대자 모델, 그래프 Clone/Revert |
| M6 | 완료 | Counter-RAPTOR 방어, Astoria 방어, Python 분석 파이프라인, 6종 시각화 |
| M7 | 보류 | Hidden Service v3 — 배경 문서 4개 작성 완료, 구현 결정 대기 |

---

## 핵심 발견 요약

### 전체 상관율 (RQ1)

| 시나리오 | 상관 회로 | 상관율 | Vanilla 대비 감소 |
|----------|----------|--------|-------------------|
| Vanilla (방어 없음) | 37,572 / 1,944,150 | **1.93%** | — |
| Counter-RAPTOR | 35,856 | **1.84%** | -4.6% |
| Astoria | 12 | **~0.00%** | **-99.97%** |
| Combined (CR + Astoria) | 5 | **~0.00%** | **-99.99%** |

### 클라이언트 침해율

| 시나리오 | 침해 클라이언트 | 침해율 |
|----------|----------------|--------|
| Vanilla | 34/50 | **68%** |
| Astoria | 9/50 | **18%** |
| Combined | 5/50 | **10%** |

### 주요 발견

1. **AS-level 글로벌 관찰자의 상관율은 1.93%** — Johnson et al.(2013)의 40%보다 낮으나, 이는 본 시뮬레이션이 727개 Tor 관련 AS만 모델링하고, destination AS를 고정하지 않았기 때문이다.
2. **Counter-RAPTOR 단독으로는 효과가 미미** (4.6% 감소) — Guard 재가중만으로는 transit AS 관찰을 막을 수 없다.
3. **Astoria가 상관을 사실상 완전 제거** (99.97% 감소) — entry/exit transit AS 교집합 검사가 매우 효과적이다.
4. **국가 수준 BGP 공격이 가장 위협적** — DE 국가 적대자(73개 AS)가 AS6939(Hurricane Electric)을 hijack하면 상관율이 1.84배 증가한다.
5. **90일간 68%의 클라이언트가 최소 1회 상관됨** — 방어 없이는 장기적으로 대부분의 사용자가 취약하다.
